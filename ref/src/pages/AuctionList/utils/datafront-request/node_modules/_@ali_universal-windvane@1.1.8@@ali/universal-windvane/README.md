# universal-windvane ![universal-windvane](http://web.npm.alibaba-inc.com/badge/v/@ali/universal-windvane.svg)

提供与客户端通讯的机制。支持 WindVane SDK v2.2 以上版本。

* [WindVane api](http://h5.alibaba-inc.com/api/WindVane-API.html)
* [手淘专有WindVane api](http://h5.alibaba-inc.com/api/TaobaoClient-API.html)

## 使用

```js
import Windvane from '@ali/universal-windvane';
```

### Web

要使用 JSBridge API，在 html 中请引入 [//g.alicdn.com/mtb/lib-windvane/2.1.8/windvane.js](//g.alicdn.com/mtb/lib-windvane/2.1.8/windvane.js)，它提供了调用客户端接口的功能。

```js
<script src="//g.alicdn.com/mtb/lib-windvane/2.1.8/windvane.js"></script>
```

## 方法

### `call(ClassName, MethodName, options, successCallback, failureCallback)`
`旧版本的调用方法，已废弃，注意用法与常用习惯不同。`
调 windvane api

#### 参数

| 属性 | 类型 | 描述 | 必选 | 默认值 |
|---|---|---|---|---|
| `ClassName` | String | API 类名。 | 是 | - |
| `MethodName` | String | API 方法名。 | 是 | 无 |
| `options` | Object | 参数：具体参考 [windvane 官网文档](http://h5.alibaba-inc.com/api/WindVane-API.html)。 | 否 | - |
| `successCallback` | Function | 成功回调。 | 否 | - |
| `failureCallback` | Function | 失败回调。 | 否 | - |

#### 示例

```js
Windvane.call('WebAppInterface', 'setCustomPageTitle', {
  title: '设置标题'
}, () => {
  alert('设置成功');
}, (error) => {
  alert(JSON.stringify(error))
  document.title = '设置标题';
});
```

### `call2(name, params, successCallback, failureCallback)`

调用 WindVane 提供的 JSBridge。

#### 参数

| 属性 | 类型 | 描述 | 必选 | 默认值 |
|-----|---|---|---|---|
| `name` | String | 要调用的 JSBridge 的名称，注意格式为 `类名.方法名`。 | 是 | - |
| `params` | Object | 参数：具体参考 [windvane 官网文档](http://h5.alibaba-inc.com/api/WindVane-API.html)。 | 否 | `null` |
| `successCallback` | Function | 成功回调。 | 否 | `null` |
| `failureCallback` | Function | 失败回调。 | 否 | `null` |

#### 示例

```js
Windvane.call2('WebAppInterface.setCustomPageTitle', {
  title: '设置标题'
}, () => {
  alert('设置成功');
}, (error) => {
  alert(JSON.stringify(error))
  document.title = '设置标题';
});

```

## 说明

* 由于 windvane 链路太长，依赖过重，Weex 后期会把每个 API 封装出 module 开放出来
* 对于 weex 安卓端，涉及到 UI 部分的都不支持
* API 中涉及到 window、document 浏览器相关变量的都不支持
