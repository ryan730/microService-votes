/**
 * url 控制
 */

/**
 * 获取 url 中某个参数的值
 * @param  {String} name 参数名
 * @return {any}         参数值
 */
exports.getQueryString = function(name) {
  var url = window.location.href;
  var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
  var index = url.indexOf('?');
  var r = url.substr(index).substr(1).match(reg);  //获取url中"?"符后的字符串并正则匹配
  var context = '';
  if (r != null)
    context = r[2];
  reg = null;
  r = null;
  return context == null || context == '' || context == 'undefined' ? '' : context;
};

/**
 * 修改 URL 中的某个参数
 * @param  {String} url     要修改的 url
 * @param  {String} arg     参数名
 * @param  {String} arg_val 参数值
 * @return {String}         修改之后的 url
 */
exports.changeURLArg = function(url, arg, arg_val) {
  var pattern = arg + '=([^&]*)';
  var replaceText = arg + '=' + arg_val;
  if (url.match(pattern)) {
    var tmp = '/(' + arg + '=)([^&]*)/gi';
    tmp = url.replace(eval(tmp), replaceText);
    return tmp;
  } else {
    if (url.match('[\?]')) {
      return url + '&' + replaceText;
    } else {
      return url + '?' + replaceText;
    }
  }
  return url + '\n' + arg + '\n' + arg_val;
};

/**
 * 新开或者直接修改url
 * rx环境下使用 rx-window即可
 * @param  {String} url 要打开的url
 */
exports.open = function(url) {
  if (isWindVane()) {
    url = encodeURI(url);
    window.WindVane.call('Base', 'openWindow', {url: url}, null, function() {
      window.location.href = url;
    });
  } else {
    window.location.href = url;
  }
};


function isWindVane() {
  return window && window.WindVane && window.WindVane.isAvailable;
}